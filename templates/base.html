<!doctype html>
<html lang="pt-br">
<head>
  {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}ARPIA{% endblock %}</title>
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicons/apple-touch-icon.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicons/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicons/favicon-16x16.png' %}">
  <link rel="manifest" href="{% static 'favicons/site.webmanifest' %}">
  <link rel="icon" href="{% static 'favicons/favicon.ico' %}">
  <meta name="theme-color" content="#020c1f">
  <link rel="stylesheet" href="{% static 'css/dark.css' %}">
  <style>
    /* botão logout — estilo semelhante ao "Gerar Selecionados", com cor de ação de saída */
    .btn-logout{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.4rem .7rem;
      border-radius:8px;
      background:rgba(255,139,139,0.06);
      color:#ff8b8b;
      border:1px solid rgba(255,139,139,0.08);
      font-weight:700;
      text-decoration:none;
      cursor:pointer;
    }
    .btn-logout:hover{ background:rgba(255,139,139,0.10); color:#ff6b6b; }

    /* perfil / dropdown */
    .profile-dropdown{ position:relative; display:inline-block; }
    .profile-btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .6rem; border-radius:8px; background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); cursor:pointer; font-weight:700; }
    .profile-btn:hover{ color:var(--text); border-color:rgba(255,255,255,0.06); background:rgba(255,255,255,0.01); }
    .profile-menu{ position:absolute; right:0; top:calc(100% + 6px); min-width:200px; background:rgba(2,16,35,0.95); border-radius:8px; box-shadow:0 12px 36px rgba(2,16,35,0.6); border:1px solid rgba(255,255,255,0.03); padding:.35rem; z-index:40; }
    .profile-item{ display:block; padding:.5rem .6rem; color:var(--muted); text-decoration:none; border-radius:6px; }
    .profile-item:hover{ background:rgba(255,255,255,0.02); color:var(--text); }
    .profile-item.logout{ color:#ff8b8b; margin-top:.25rem; border-top:1px solid rgba(255,255,255,0.02); padding-top:.6rem; }
  </style>
</head>
<body class="arpia-dark">

  <aside class="sidebar collapsed" id="sidebar" aria-label="Menu lateral">
    <div class="brand">
      <!-- substituir texto pelo logo pequeno -->
      <a href="{% url 'dashboard' %}" style="display:inline-flex;align-items:center;gap:.5rem;text-decoration:none;">
        <img src="{% static 'img/logo-40x40.png' %}" alt="ARPIA" style="width:40px;height:40px;display:block;">
      </a>
    </div>

    <nav class="menu" role="navigation">
      <a href="{% url 'dashboard' %}" class="menu-item" title="Home">
        <img src="{% static 'icons/home.svg' %}" class="icon" alt="Home">
        <span class="label">Home</span>
      </a>

      <!-- menu-section removida -->

      <a href="{% url 'projects_list' %}" class="menu-item" title="Projetos">
        <img src="{% static 'icons/squares-2x2.svg' %}" class="icon" alt="Projetos">
        <span class="label">Projetos</span>
      </a>

      <a href="{% url 'scripts_list' %}" class="menu-item" title="Scripts">
        <img src="{% static 'icons/code-bracket.svg' %}" class="icon" alt="Scripts">
        <span class="label">Scripts</span>
      </a>

      <a href="{% url 'tools_list' %}" class="menu-item" title="Ferramentas">
        <img src="{% static 'icons/wrench-screwdriver.svg' %}" class="icon" alt="Ferramentas">
        <span class="label">Ferramentas</span>
      </a>

  <a href="{% url 'arpia_report:report_home' %}" class="menu-item" title="Relatórios">
        <img src="{% static 'icons/chart-pie.svg' %}" class="icon" alt="Relatórios">
        <span class="label">Relatórios</span>
      </a>

      <a href="{% url 'logs_list' %}" class="menu-item" title="Logs">
        <img src="{% static 'icons/document-text.svg' %}" class="icon" alt="Logs">
        <span class="label">Logs</span>
      </a>

      <!-- nova entrada de menu para AI (arpia_ai) -->
      <a href="{% url 'ai_list' %}" class="menu-item" title="AI">
        <img src="{% static 'icons/star.svg' %}" class="icon" alt="AI">
        <span class="label">AI</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <a href="{% url 'admin:index' %}" class="menu-item small" title="Admin">
        <img src="{% static 'icons/cog-6-tooth.svg' %}" class="icon" alt="Admin">
        <span class="label">Admin</span>
      </a>
    </div>

    <button id="toggleSidebar" class="toggle-btn" aria-label="Expandir menu">☰</button>
  </aside>

  <header class="topbar">
    <div class="top-left">
      <div class="module-switch">
        {% with current_namespace=request.resolver_match.namespace current_url=request.resolver_match.url_name %}
          <a href="{% url 'arpia_scan:dashboard' %}" class="module {% if current_namespace == 'arpia_scan' %}active{% endif %}">Scan</a>
          <a href="{% url 'arpia_vuln:dashboard' %}" class="module {% if current_namespace == 'arpia_vuln' %}active{% endif %}">Vuln</a>
          <a href="{% url 'arpia_hunt:dashboard' %}" class="module {% if current_namespace == 'arpia_hunt' %}active{% endif %}">Hunt</a>
          <a href="{% url 'arpia_pentest:dashboard' %}" class="module {% if current_namespace == 'arpia_pentest' or current_url == 'pentest_dashboard' %}active{% endif %}">Pentest</a>
        {% endwith %}
      </div>
    </div>

    <div class="top-right">
      <div class="user-area">
        {% if user.is_authenticated %}
          <div class="profile-dropdown" id="profileDropdown">
            <button id="profileBtn" class="profile-btn" aria-haspopup="true" aria-expanded="false">
              <span class="user">Olá, {{ user.username }}</span>
              <span style="opacity:.8;">▾</span>
            </button>
            <div id="profileMenu" class="profile-menu" hidden>
              <a href="/profile/" class="profile-item">Configurar perfil</a>
              <a href="/accounts/password_change/" class="profile-item">Trocar senha</a>
              <a href="{% url 'logout' %}" class="profile-item logout">Sair</a>
            </div>
          </div>
        {% else %}
          <a href="{% url 'login' %}" class="link">Login</a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="main" id="main">
    {% block content %}{% endblock %}
  </main>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{% static 'js/dashboard.js' %}"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const sb = document.getElementById('sidebar');
    const btn = document.getElementById('toggleSidebar');
    function toggle(){ sb.classList.toggle('collapsed'); document.getElementById('main').classList.toggle('sidebar-expanded'); }
    if(btn) btn.addEventListener('click', toggle);

    // profile dropdown toggle / close on outside click
    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profileMenu');
    if(profileBtn && profileMenu){
      profileBtn.addEventListener('click', (ev)=>{
        const expanded = profileBtn.getAttribute('aria-expanded') === 'true';
        profileBtn.setAttribute('aria-expanded', String(!expanded));
        if(expanded){ profileMenu.hidden = true; } else { profileMenu.hidden = false; }
      });
      document.addEventListener('click', (ev)=>{
        if(!profileMenu.hidden && !ev.target.closest('#profileDropdown')){ profileMenu.hidden = true; profileBtn.setAttribute('aria-expanded','false'); }
      });
    }
  });
  </script>
</body>
</html>
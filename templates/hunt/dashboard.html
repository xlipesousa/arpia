{% extends "base.html" %}
{% block title %}Hunt — ARPIA{% endblock %}

{% block content %}
<section class="page-heading">
  <div>
    <h1>Módulo Hunt</h1>
    <p class="page-subtitle">Fase atual: {{ phase }} · Snapshot base: {{ snapshot_label }}</p>
  </div>
  <div class="heading-actions">
    {% if request.GET.project %}
      <a href="{% url 'arpia_hunt:dashboard' %}?project={{ request.GET.project }}&amp;format=json" class="btn-secondary" target="_blank" rel="noopener noreferrer">Exportar JSON</a>
      <a href="{% url 'arpia_hunt:dashboard' %}?project={{ request.GET.project }}&amp;format=pdf" class="btn-secondary" target="_blank" rel="noopener noreferrer">Exportar PDF</a>
    {% else %}
      <a href="{% url 'arpia_hunt:dashboard' %}?format=json" class="btn-secondary" target="_blank" rel="noopener noreferrer">Exportar JSON</a>
      <a href="{% url 'arpia_hunt:dashboard' %}?format=pdf" class="btn-secondary" target="_blank" rel="noopener noreferrer">Exportar PDF</a>
    {% endif %}
  </div>
</section>

<section class="panel alert-panel" data-tab-group="hunt-profiles">
  <header class="panel-header alert-header">
    <div>
      <h2>Alertas automatizados · Perfis Blue/Red</h2>
      <p class="muted">Visão consolidada dos findings priorizados e recomendações acionáveis disponíveis na operação.</p>
    </div>
    <div class="tab-controls">
      <button type="button" class="tab-control active" data-tab-target="blue">Blue Team</button>
      <button type="button" class="tab-control" data-tab-target="red">Red Team</button>
    </div>
  </header>
  <div class="tab-panels">
    <div class="tab-panel active" data-tab-panel="blue">
      {% if blue_tabs %}
        <div class="profile-accordion">
          {% for card in blue_tabs %}
            <details class="profile-item" data-tone="blue">
              <summary class="profile-summary-row">
                <span class="summary-left">
                  <span class="badge severity-{{ card.finding.severity }}">{{ card.finding.get_severity_display }}</span>
                  <span class="summary-text">
                    <strong><a href="{% url 'arpia_hunt:finding-detail' card.finding.id %}">{{ card.finding.vulnerability.title }}</a></strong>
                    <small>{{ card.finding.project.name }}</small>
                  </span>
                </span>
                <span class="summary-meta">
                  {% if card.finding.cvss_score %}
                    <span class="meta-chip">CVSS {{ card.finding.cvss_score|floatformat:1 }}</span>
                  {% endif %}
                  {% if card.finding.cve %}
                    <span class="meta-chip">{{ card.finding.cve }}</span>
                  {% endif %}
                  {% if card.profile.confidence %}
                    <span class="meta-chip">{{ card.profile.confidence|title }}</span>
                  {% endif %}
                </span>
              </summary>
              <div class="profile-body">
                <p class="profile-summary">{{ card.profile.summary|default:card.finding.summary|default:"Sem resumo." }}</p>
                {% include "hunt/components/heuristic_chips.html" with heuristics=card.heuristics %}
                {% include "hunt/components/recommendation_list.html" with recommendations=card.recommendations tone="blue" empty_message="Nenhuma recomendação automatizada ainda." %}
                <div class="card-actions">
                  <a class="detail-link" href="{% url 'arpia_hunt:finding-detail' card.finding.id %}">Abrir detalhe</a>
                </div>
              </div>
            </details>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">Gere perfis Blue executando <code>python manage.py hunt_enrich</code>.</p>
      {% endif %}
    </div>
    <div class="tab-panel" data-tab-panel="red">
      {% if red_tabs %}
        <div class="profile-accordion">
          {% for card in red_tabs %}
            <details class="profile-item" data-tone="red">
              <summary class="profile-summary-row">
                <span class="summary-left">
                  <span class="badge severity-{{ card.finding.severity }}">{{ card.finding.get_severity_display }}</span>
                  <span class="summary-text">
                    <strong><a href="{% url 'arpia_hunt:finding-detail' card.finding.id %}">{{ card.finding.vulnerability.title }}</a></strong>
                    <small>{{ card.finding.project.name }}</small>
                  </span>
                </span>
                <span class="summary-meta">
                  {% if card.finding.cvss_score %}
                    <span class="meta-chip">CVSS {{ card.finding.cvss_score|floatformat:1 }}</span>
                  {% endif %}
                  {% if card.finding.cve %}
                    <span class="meta-chip">{{ card.finding.cve }}</span>
                  {% endif %}
                  {% if card.profile.confidence %}
                    <span class="meta-chip">{{ card.profile.confidence|title }}</span>
                  {% endif %}
                </span>
              </summary>
              <div class="profile-body">
                {% if card.profile.exploits %}
                  <ul class="exploit-list">
                    {% for exploit in card.profile.exploits|slice:":3" %}
                      <li>
                        <strong>{{ exploit.title|default:"Exploit" }}</strong>
                        <span class="muted">Fonte: {{ exploit.source|default:"?" }}</span>
                        {% if exploit.url %}<a href="{{ exploit.url }}" target="_blank" rel="noopener">Abrir</a>{% endif %}
                        {% if exploit.path %}<code>{{ exploit.path }}</code>{% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="muted">Sem exploits correlacionados.</p>
                {% endif %}
                {% include "hunt/components/heuristic_chips.html" with heuristics=card.heuristics %}
                {% include "hunt/components/recommendation_list.html" with recommendations=card.recommendations tone="red" empty_message="Nenhuma recomendação Red disponível ainda." %}
                <div class="card-actions">
                  <a class="detail-link" href="{% url 'arpia_hunt:finding-detail' card.finding.id %}">Abrir detalhe</a>
                </div>
              </div>
            </details>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">Execute o pipeline de enriquecimento para liberar recomendações Red.</p>
      {% endif %}
    </div>
  </div>
</section>

<section class="panel-stack">
  <article class="panel">
    <header class="panel-header">
      <div>
        <h2>Foco atual</h2>
        <p class="muted">Prioridades da fase de automação e alertas.</p>
      </div>
    </header>
    <ul class="bullet-list">
      {% for item in phase_objectives %}
        <li>{{ item }}</li>
      {% endfor %}
    </ul>
  </article>

  <article class="panel">
    <header class="panel-header">
      <div>
        <h2>Fontes de dados</h2>
        <p class="muted">Bases ativas que alimentam correlação e disparo de alertas.</p>
      </div>
    </header>
    <ul class="data-sources">
      {% for source in data_sources %}
        <li>
          <strong>{{ source.label }}</strong>
          <p>{{ source.description }}</p>
        </li>
      {% endfor %}
    </ul>
  </article>

  <article class="panel">
    <header class="panel-header">
      <div>
        <h2>Entregáveis Fase 5</h2>
        <p class="muted">Pontos de controle para consolidar automação e monitoramento.</p>
      </div>
    </header>
    <ul class="deliverables">
      {% for deliverable in deliverables %}
        <li>{{ deliverable }}</li>
      {% endfor %}
    </ul>
  </article>

  <article class="panel">
    <header class="panel-header">
      <div>
        <h2>Próximos passos</h2>
        <p class="muted">Sequência planejada para estabilizar a operação dos alertas.</p>
      </div>
    </header>
    <ul class="next-steps">
      {% for step in next_steps %}
        <li>{{ step }}</li>
      {% endfor %}
    </ul>
  </article>

  <article class="panel">
    <header class="panel-header">
      <div>
        <h2>Indicadores atuais</h2>
        <p class="muted">Totais de achados que sustentam os alertas configurados.</p>
      </div>
    </header>
    <dl class="stats-grid">
      <div><dt>Total de achados</dt><dd>{{ stats.findings_total }}</dd></div>
      <div><dt>Achados ativos</dt><dd>{{ stats.findings_active }}</dd></div>
      <div><dt>Com CVE associado</dt><dd>{{ stats.findings_with_cve }}</dd></div>
    </dl>
  </article>
</section>

<section class="panel roles-panel">
  <header class="panel-header">
    <div>
      <h2>Visão orientada a perfis</h2>
      <p class="muted">Como os dados serão apresentados para Blue-Team (protetores) e Red-Team (atacantes).</p>
    </div>
  </header>
  <div class="role-columns">
    <div class="role-card blue">
      <h3>Blue-Team · Protetores</h3>
      <p>Consolidar evidências priorizando mitigação, redução de superfície e recomendações defensivas.</p>
      <ul>
        <li>Mapa de vulnerabilidades com criticidade, contexto do ativo e impacto operacional.</li>
        <li>Integração com MITRE ATT&amp;CK para orientar detecções e controles.</li>
        <li>Sugestões de correção, compensação e melhoria de monitoramento.</li>
      </ul>
    </div>
    <div class="role-card red">
      <h3>Red-Team · Atacantes</h3>
      <p>Organizar TTPs, exploits e caminhos de escalada com base nos achados do Scan e do Vuln.</p>
      <ul>
        <li>Correlação com exploits públicos (Vulners, searchsploit, Metasploit).</li>
        <li>Linhas de ataque por fase (reconhecimento, acesso inicial, movimento lateral).</li>
        <li>Exportação de dados para alimentar o módulo Pentest.</li>
      </ul>
    </div>
  </div>
</section>

<section class="panel profile-panel">
  <header class="panel-header">
    <div>
      <h2>Insights recentes</h2>
      <p class="muted">Perfis Blue/Red gerados a partir do enriquecimento externo.</p>
    </div>
  </header>
  <div class="profile-columns">
    <div class="profile-card blue">
      <h3>Blue-Team</h3>
      {% if blue_insights %}
        <div class="profile-accordion">
          {% for item in blue_insights %}
            <details class="profile-item" data-tone="blue">
              <summary class="profile-summary-row">
                <span class="summary-left">
                  <span class="badge severity-{{ item.finding.severity }}">{{ item.finding.get_severity_display }}</span>
                  <span class="summary-text">
                    <strong><a href="{% url 'arpia_hunt:finding-detail' item.finding.id %}">{{ item.finding.vulnerability.title }}</a></strong>
                    <small>{% if item.finding.last_profiled_at %}{{ item.finding.last_profiled_at|date:"d/m/Y H:i" }}{% else %}—{% endif %}</small>
                  </span>
                </span>
                <span class="summary-meta">
                  {% if item.finding.cvss_score %}
                    <span class="meta-chip">CVSS {{ item.finding.cvss_score|floatformat:1 }}</span>
                  {% endif %}
                  {% if item.finding.cve %}
                    <span class="meta-chip">{{ item.finding.cve }}</span>
                  {% endif %}
                  {% if item.profile.confidence %}
                    <span class="meta-chip">{{ item.profile.confidence|title }}</span>
                  {% endif %}
                </span>
              </summary>
              <div class="profile-body">
                <p class="profile-summary">{{ item.profile.summary|default:item.finding.summary|default:"Sem resumo." }}</p>
                <dl>
                  <div><dt>Projeto</dt><dd>{{ item.finding.project.name }}</dd></div>
                  {% if item.profile.references %}
                    <div><dt>Referências</dt><dd><a href="{{ item.profile.references.0 }}" target="_blank" rel="noopener">Ver primeira referência</a>{% if item.profile.references|length > 1 %} · {{ item.profile.references|length }} links{% endif %}</dd></div>
                  {% endif %}
                </dl>
                <div class="card-actions">
                  <a class="detail-link" href="{% url 'arpia_hunt:finding-detail' item.finding.id %}">Abrir detalhe</a>
                </div>
              </div>
            </details>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">Nenhum perfil Blue gerado ainda. Execute <code>python manage.py hunt_enrich</code>.</p>
      {% endif %}
    </div>
    <div class="profile-card red">
      <h3>Red-Team</h3>
      {% if red_insights %}
        <div class="profile-accordion">
          {% for item in red_insights %}
            <details class="profile-item" data-tone="red">
              <summary class="profile-summary-row">
                <span class="summary-left">
                  <span class="badge severity-{{ item.finding.severity }}">{{ item.finding.get_severity_display }}</span>
                  <span class="summary-text">
                    <strong><a href="{% url 'arpia_hunt:finding-detail' item.finding.id %}">{{ item.finding.vulnerability.title }}</a></strong>
                    <small>{% if item.finding.last_profiled_at %}{{ item.finding.last_profiled_at|date:"d/m/Y H:i" }}{% else %}—{% endif %}</small>
                  </span>
                </span>
                <span class="summary-meta">
                  {% if item.finding.cvss_score %}
                    <span class="meta-chip">CVSS {{ item.finding.cvss_score|floatformat:1 }}</span>
                  {% endif %}
                  {% if item.finding.cve %}
                    <span class="meta-chip">{{ item.finding.cve }}</span>
                  {% endif %}
                  {% if item.profile.confidence %}
                    <span class="meta-chip">{{ item.profile.confidence|title }}</span>
                  {% endif %}
                </span>
              </summary>
              <div class="profile-body">
                {% if item.profile.exploits %}
                  <ul class="exploit-list">
                    {% for exploit in item.profile.exploits|slice:":3" %}
                      <li>
                        <strong>{{ exploit.title|default:"Exploit" }}</strong>
                        <span class="muted">Fonte: {{ exploit.source|default:"?" }}</span>
                        {% if exploit.url %}<a href="{{ exploit.url }}" target="_blank" rel="noopener">Abrir</a>{% endif %}
                        {% if exploit.path %}<code>{{ exploit.path }}</code>{% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="muted">Sem exploits correlacionados.</p>
                {% endif %}
                <div class="card-actions">
                  <a class="detail-link" href="{% url 'arpia_hunt:finding-detail' item.finding.id %}">Abrir detalhe</a>
                </div>
              </div>
            </details>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">Nenhum perfil Red gerado ainda. Execute <code>python manage.py hunt_enrich</code>.</p>
      {% endif %}
    </div>
  </div>
</section>

<section class="panel notes-panel">
  <header class="panel-header">
    <div>
      <h2>Notas rápidas</h2>
      <p class="muted">Pontos de atenção práticos enquanto integrarmos os catálogos externos.</p>
    </div>
  </header>
  <ul class="notes-list">
    <li>Respeitar limites de rate das APIs NVD e Vulners usando cache local incremental.</li>
    <li>Definir formato canônico para armazenar resultados do searchsploit sem exigir parsing manual a cada consulta.</li>
    <li>Garantir que dados sensíveis (creds, PoCs) sejam tratados com controles de acesso adequados.</li>
    <li>Registrar cada tentativa no arpia_log para facilitar auditoria e troubleshooting.</li>
  </ul>
</section>

<section class="panel sync-panel">
  <header class="panel-header">
    <div>
      <h2>Histórico de sincronizações</h2>
      <p class="muted">Últimas execuções do pipeline de ingestão Hunt.</p>
    </div>
  </header>
  {% if recent_syncs %}
    <table class="sync-table">
      <thead>
        <tr>
          <th>Iniciada</th>
          <th>Status</th>
          <th>Total</th>
          <th>Criados</th>
          <th>Atualizados</th>
          <th>Ignorados</th>
          <th>Duração (ms)</th>
        </tr>
      </thead>
      <tbody>
        {% for run in recent_syncs %}
          <tr>
            <td>{{ run.started_at|date:"d/m/Y H:i" }}</td>
            <td><span class="badge status-{{ run.status }}">{{ run.get_status_display }}</span></td>
            <td>{{ run.total_processed }}</td>
            <td>{{ run.created_count }}</td>
            <td>{{ run.updated_count }}</td>
            <td>{{ run.skipped_count }}</td>
            <td>{{ run.duration_ms }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">Nenhuma sincronização registrada ainda. Execute <code>python manage.py hunt_sync</code> para iniciar.</p>
  {% endif %}
</section>

<section class="panel log-panel">
  <header class="panel-header">
    <div>
      <h2>Eventos recentes do Hunt</h2>
      <p class="muted">Recortes do arpia_log para acompanhar sincronizações e enriquecimentos.</p>
    </div>
  </header>
  {% if recent_logs %}
    <ul class="log-feed">
      {% for entry in recent_logs %}
        <li>
          <header>
            <span class="badge severity-{{ entry.severity|lower }}">{{ entry.severity }}</span>
            <span class="timestamp">{{ entry.timestamp|date:"d/m/Y H:i" }}</span>
            <span class="event-type">{{ entry.event_type }}</span>
          </header>
          <p class="message">{{ entry.message }}</p>
          {% if entry.details %}
            <dl class="details">
              {% for key, value in entry.details.items %}
                <div><dt>{{ key }}</dt><dd>{{ value }}</dd></div>
              {% endfor %}
            </dl>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="muted">Sem eventos registrados ainda. Rode o sincronizador ou enriquecimentos para popular esta área.</p>
  {% endif %}
</section>

<script>
document.addEventListener("DOMContentLoaded",function(){const group=document.querySelector('[data-tab-group="hunt-profiles"]');if(!group){return;}const controls=Array.from(group.querySelectorAll('[data-tab-target]'));const panels=Array.from(group.querySelectorAll('[data-tab-panel]'));controls.forEach(function(control){control.addEventListener("click",function(){controls.forEach(function(btn){btn.classList.toggle("active",btn===control);});panels.forEach(function(panel){panel.classList.toggle("active",panel.dataset.tabPanel===control.dataset.tabTarget);});});});});
</script>

<style>
.page-heading{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1.6rem;gap:1rem;}
.page-heading h1{margin:0;font-size:1.9rem;color:var(--text);}
.heading-actions{display:flex;align-items:center;gap:.6rem;}
.page-subtitle{margin:.25rem 0 0;font-size:.95rem;color:var(--muted);}
.alert-panel{margin-bottom:1.8rem;}
.alert-header{align-items:center;}
.tab-controls{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;}
.tab-control{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);color:var(--text);padding:.45rem 1rem;border-radius:999px;font-size:.85rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;cursor:pointer;transition:all .2s ease;}
.tab-control:hover{border-color:rgba(118,187,255,0.4);color:#d5ecff;}
.tab-control.active{background:rgba(118,187,255,0.18);border-color:rgba(118,187,255,0.42);color:#e9f4ff;}
.tab-panels{margin-top:1.2rem;}
.tab-panel{display:none;}
.tab-panel.active{display:block;}
.profile-accordion{display:flex;flex-direction:column;gap:1rem;margin:0;padding:0;list-style:none;}
.profile-item{border-radius:14px;border:1px solid rgba(255,255,255,0.09);background:rgba(6,22,42,0.78);box-shadow:0 16px 32px rgba(5,16,32,0.32);overflow:hidden;}
.profile-item[data-tone="blue"]{border-color:rgba(118,187,255,0.24);}
.profile-item[data-tone="red"]{border-color:rgba(255,138,138,0.24);}
.profile-item summary{list-style:none;}
.profile-item summary::-webkit-details-marker{display:none;}
.profile-summary-row{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:1rem 1.2rem;cursor:pointer;}
.profile-item[open] .profile-summary-row{border-bottom:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02);}
.summary-left{display:flex;align-items:center;gap:.75rem;min-width:0;}
.summary-text{display:flex;flex-direction:column;gap:.15rem;min-width:0;}
.summary-text strong{color:var(--text);font-size:1rem;line-height:1.2;}
.summary-text strong a{color:inherit;text-decoration:none;}
.summary-text strong a:hover{text-decoration:underline;}
.summary-text small{color:var(--muted);font-size:.78rem;}
.summary-meta{display:flex;align-items:center;gap:.45rem;flex-wrap:wrap;justify-content:flex-end;}
.profile-summary-row::after{content:"\25BC";font-size:.75rem;color:var(--muted);transition:transform .2s ease;}
.profile-item[open] .profile-summary-row::after{transform:rotate(180deg);}
.profile-summary-row:focus{outline:2px solid rgba(118,187,255,0.45);outline-offset:3px;}
.meta-chip{display:inline-flex;align-items:center;gap:.25rem;padding:.35rem .65rem;border-radius:999px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.16);font-size:.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;}
.profile-body{padding:1.1rem 1.3rem;display:flex;flex-direction:column;gap:.9rem;background:rgba(255,255,255,0.02);}
.profile-summary{margin:0;color:var(--muted);line-height:1.35;font-size:.9rem;}
.heuristic-chips{list-style:none;margin:.6rem 0 0;padding:0;display:flex;flex-wrap:wrap;gap:.45rem;}
.heuristic-chips li{padding:.3rem .65rem;border-radius:999px;background:rgba(118,187,255,0.12);border:1px solid rgba(118,187,255,0.28);color:#d5ecff;font-size:.72rem;font-weight:600;letter-spacing:.06em;}
.recommendation-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.55rem;}
.recommendation-list li{padding:.7rem .85rem;border-radius:12px;background:rgba(118,187,255,0.08);border:1px solid rgba(118,187,255,0.18);display:flex;flex-direction:column;gap:.35rem;}
.recommendation-list.red li{background:rgba(255,138,138,0.08);border-color:rgba(255,138,138,0.22);}
.recommendation-list strong{color:var(--text);}
.recommendation-list .muted{font-size:.82rem;}
.tagged{display:inline-block;margin-top:.2rem;font-size:.72rem;color:rgba(223,240,255,0.92);text-transform:uppercase;letter-spacing:.08em;}
.card-actions{margin-top:.6rem;display:flex;flex-wrap:wrap;justify-content:flex-end;}
.detail-link{display:inline-flex;align-items:center;gap:.35rem;padding:.45rem .9rem;border-radius:999px;background:rgba(118,187,255,0.12);border:1px solid rgba(118,187,255,0.28);color:#e3f1ff;font-size:.78rem;font-weight:600;text-decoration:none;text-transform:uppercase;letter-spacing:.08em;transition:all .2s ease;}
.detail-link:hover{background:rgba(118,187,255,0.2);border-color:rgba(118,187,255,0.42);color:#fff;}
.panel-stack{display:flex;flex-direction:column;gap:1.4rem;margin-bottom:1.6rem;}
.panel-stack>.panel{width:100%;}
.panel{background:rgba(8,23,43,0.78);border-radius:16px;padding:1.4rem;border:1px solid rgba(255,255,255,0.05);box-shadow:0 18px 38px rgba(5,16,32,0.35);position:relative;overflow:hidden;}
.panel-header{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;margin-bottom:1.2rem;}
.panel-header h2{margin:0;color:var(--text);font-size:1.35rem;}
.panel-header p{margin:0;color:var(--muted);font-size:.9rem;}
.bullet-list,.deliverables,.next-steps,.notes-list{list-style:disc;margin:0;padding-left:1.2rem;display:flex;flex-direction:column;gap:.6rem;color:var(--muted);}
.data-sources{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.9rem;}
.data-sources li{padding:.85rem 1rem;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);}
.data-sources strong{display:block;color:var(--text);margin-bottom:.35rem;font-size:1rem;}
.data-sources p{margin:0;color:var(--muted);font-size:.9rem;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.9rem;margin:0;}
.stats-grid div{display:flex;flex-direction:column;gap:.25rem;padding:.85rem 1rem;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);}
.stats-grid dt{margin:0;color:var(--muted);font-size:.8rem;text-transform:uppercase;letter-spacing:.08em;}
.stats-grid dd{margin:0;color:var(--text);font-weight:700;font-size:1.2rem;}
.roles-panel{margin-bottom:1.6rem;}
.role-columns{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.2rem;}
.role-card{padding:1.2rem;border-radius:14px;border:1px solid rgba(255,255,255,0.05);background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:.8rem;}
.role-card h3{margin:0;color:var(--text);font-size:1.1rem;}
.role-card p{margin:0;color:var(--muted);}
.role-card ul{margin:0;padding-left:1.1rem;display:flex;flex-direction:column;gap:.45rem;color:var(--muted);}
.role-card.blue{background:rgba(118,187,255,0.08);border-color:rgba(118,187,255,0.18);}
.role-card.red{background:rgba(255,138,138,0.08);border-color:rgba(255,138,138,0.18);}
.profile-panel{margin-bottom:2rem;}
.profile-columns{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.4rem;}
.profile-card{padding:1.2rem;border-radius:14px;border:1px solid rgba(255,255,255,0.05);background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:1.1rem;}
.profile-card h3{margin:0;font-size:1.1rem;color:var(--text);}
.profile-card ul{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.9rem;}
.profile-card header{display:flex;align-items:center;gap:.6rem;}
.profile-card header strong{flex:1;color:var(--text);}
.profile-card header strong a{color:inherit;text-decoration:none;}
.profile-card header strong a:hover{text-decoration:underline;}
.profile-card header small{color:var(--muted);font-size:.78rem;}
.profile-card dl{margin:0;display:flex;flex-wrap:wrap;gap:.6rem 1.2rem;font-size:.82rem;color:var(--muted);}
.profile-card dl div{display:flex;flex-direction:column;gap:.2rem;}
.profile-card.blue{background:rgba(118,187,255,0.08);border-color:rgba(118,187,255,0.18);}
.profile-card.red{background:rgba(255,138,138,0.08);border-color:rgba(255,138,138,0.18);}
.exploit-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.5rem;}
.exploit-list li{display:flex;flex-direction:column;gap:.2rem;}
.notes-panel{margin-bottom:2rem;}
.notes-list li{line-height:1.4;}
.sync-panel{margin-bottom:2rem;}
.sync-table{width:100%;border-collapse:collapse;font-size:.9rem;}
.sync-table th,.sync-table td{padding:.6rem .8rem;border-bottom:1px solid rgba(255,255,255,0.05);text-align:left;}
.sync-table th{font-weight:600;color:var(--muted);text-transform:uppercase;font-size:.75rem;letter-spacing:.08em;}
.badge.status-success{background:rgba(118,221,174,0.18);color:#d8f6e9;border-radius:999px;padding:.15rem .5rem;display:inline-flex;align-items:center;gap:.3rem;}
.badge.status-error{background:rgba(255,138,138,0.18);color:#ffd4d4;border-radius:999px;padding:.15rem .5rem;display:inline-flex;}
.log-panel{margin-bottom:2rem;}
.log-feed{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.75rem;}
.log-feed li{padding:.9rem 1.1rem;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);box-shadow:0 10px 24px rgba(5,16,32,0.18);}
.log-feed .badge{display:inline-flex;align-items:center;gap:.3rem;padding:.2rem .6rem;border-radius:999px;font-size:.72rem;text-transform:uppercase;letter-spacing:.08em;}
.log-feed header{display:flex;align-items:center;gap:.6rem;font-size:.78rem;color:var(--muted);margin-bottom:.5rem;}
.log-feed .message{margin:0;color:var(--text);font-size:.9rem;}
.log-feed .details{margin:.6rem 0 0;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.4rem .6rem;font-size:.78rem;color:#9fb8d8;}
.log-feed .details dt{margin:0;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;font-size:.7rem;}
.log-feed .details dd{margin:0;color:#cfe2ff;font-weight:500;}
.log-feed .timestamp{opacity:.8;}
.log-feed .event-type{margin-left:auto;font-weight:600;color:var(--muted);font-size:.75rem;text-transform:uppercase;letter-spacing:.06em;}
.log-feed .severity-info{background:rgba(118,187,255,0.18);color:#d5ecff;}
.log-feed .severity-notice{background:rgba(140,205,255,0.2);color:#e3f2ff;}
.log-feed .severity-warn{background:rgba(255,214,165,0.28);color:#ffe0b2;}
.log-feed .severity-error{background:rgba(255,138,138,0.28);color:#ffd4d4;}
.log-feed .severity-critical{background:rgba(255,86,86,0.3);color:#ffd0d0;}
.log-feed .severity-debug{background:rgba(255,255,255,0.08);color:#f0f6ff;}
@media (max-width:960px){
  .page-heading{flex-direction:column;align-items:flex-start;}
  .heading-actions{width:100%;}
  .heading-actions .btn-secondary{width:100%;justify-content:center;}
}
</style>
{% endblock %}

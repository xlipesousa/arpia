{% extends "base.html" %}
{% load static %}
{% block title %}Novo Projeto — ARPIA{% endblock %}

{% block content %}
<section class="project-new">
  <header class="project-new__header">
    <h1>Novo Projeto</h1>
    <p>Defina os metadados iniciais do escopo para habilitar os módulos Scan, Vuln e Hunt.</p>
  </header>

  <form action="{% url 'projects_create' %}" method="post" class="project-new__form">
    {% csrf_token %}

    <div class="form-control form-control--full">
      <label for="project-name">Nome do projeto <span>*</span></label>
      <input id="project-name" name="name" required placeholder="Ex: Perímetro DMZ · 4º trimestre" value="{{ form.name|default_if_none:'' }}">
    </div>

    <div class="form-control form-control--full">
      <label for="project-description">Descrição</label>
      <textarea id="project-description" name="description" rows="4" placeholder="Contextualize objetivos, escopo e restrições do projeto.">{{ form.description|default_if_none:'' }}</textarea>
      <p class="helper-text">Esse resumo aparece para toda a equipe e ajuda a reforçar premissas.</p>
    </div>

    <div class="project-new__grid">
      <div class="form-control">
        <label for="project-client">Cliente / Unidade</label>
        <input id="project-client" name="client" type="text" placeholder="Nome da organização ou squad" value="{{ form.client|default_if_none:'' }}">
      </div>
      <div class="form-control">
        <label for="project-ports">Portas padrão</label>
        <input id="project-ports" name="ports" placeholder="ex: 22/tcp, 80/tcp, 53/udp" value="{{ form.ports|default_if_none:'' }}">
        <p class="helper-text">Use porta/protocolo. O protocolo TCP é assumido quando omitido.</p>
        {% if errors.ports %}
          <p class="form-error">{{ errors.ports }}</p>
        {% endif %}
      </div>
    </div>

    <div class="project-new__grid project-new__grid--half">
      <div class="form-control">
        <label for="proj-start">Início</label>
        <input id="proj-start" name="start" type="datetime-local" value="{{ form.start|default_if_none:'' }}">
      </div>
      <div class="form-control">
        <label for="proj-end">Término</label>
        <input id="proj-end" name="end" type="datetime-local" value="{{ form.end|default_if_none:'' }}">
      </div>
    </div>

    <footer class="form-actions">
      <a href="{% url 'projects_list' %}" class="btn btn-ghost">Cancelar</a>
      <button type="submit" class="btn btn-primary">Criar Projeto</button>
    </footer>
  </form>
</section>

<style>
.project-new{
  max-width:960px;
  margin:0 auto;
  padding:2rem 1.5rem 3rem;
}
.project-new__header{
  display:flex;
  flex-direction:column;
  gap:.35rem;
  margin-bottom:1.75rem;
}
.project-new__header h1{
  margin:0;
  font-size:2.1rem;
  color:var(--text);
  letter-spacing:-0.01em;
}
.project-new__header p{
  margin:0;
  color:var(--muted);
  max-width:640px;
}
.project-new__form{
  background:linear-gradient(135deg,rgba(9,25,45,0.65),rgba(9,25,45,0.35));
  border:1px solid rgba(79,209,197,0.12);
  border-radius:18px;
  padding:1.75rem;
  display:flex;
  flex-direction:column;
  gap:1.25rem;
  box-shadow:0 24px 48px -32px rgba(4,18,42,0.65);
}
.project-new__grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:1.25rem;
}
.project-new__grid--half{
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
}
.form-control{
  display:flex;
  flex-direction:column;
  gap:.45rem;
}
.form-control--full{
  width:100%;
}
.form-control label{
  font-weight:700;
  color:var(--muted);
  text-transform:uppercase;
  font-size:.78rem;
  letter-spacing:.16em;
}
.form-control label span{
  color:var(--accent);
}
.form-control input,
.form-control textarea{
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.05);
  background:rgba(2,16,35,0.35);
  color:var(--text);
  padding:.75rem .9rem;
  font-size:.95rem;
  transition:border-color .2s ease, box-shadow .2s ease, transform .2s ease;
}
.form-control textarea{
  resize:vertical;
  min-height:140px;
}
.form-control input:focus,
.form-control textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 1px var(--accent);
  background:rgba(6,32,55,0.55);
  transform:translateY(-1px);
}
.helper-text{
  margin:0;
  color:rgba(200,225,255,0.55);
  font-size:.82rem;
}
.form-error{
  margin:0;
  color:#f87171;
  font-size:.88rem;
  font-weight:600;
}
.form-actions{
  display:flex;
  justify-content:flex-end;
  gap:.8rem;
  margin-top:.5rem;
}
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:.4rem;
  padding:.55rem 1.1rem;
  border-radius:10px;
  font-weight:700;
  text-decoration:none;
  border:1px solid rgba(255,255,255,0.08);
  transition:transform .15s ease, box-shadow .2s ease, background .2s ease;
}
.btn:hover{ transform:translateY(-1px); }
.btn-ghost{
  color:var(--muted);
  background:rgba(255,255,255,0.02);
}
.btn-primary{
  color:#021023;
  background:linear-gradient(120deg,#4fd1c5 0%,#60efff 100%);
  border-color:rgba(79,209,197,0.35);
  box-shadow:0 18px 35px -18px rgba(79,209,197,0.65);
}
.btn-primary:active{ transform:translateY(0); }

@media (max-width:720px){
  .project-new{
    padding:1.5rem 1rem 2rem;
  }
  .project-new__form{
    padding:1.35rem;
  }
  .form-control input,
  .form-control textarea{
    padding:.65rem .75rem;
  }
}
</style>

<script>
(function(){
  const start = document.getElementById('proj-start');
  const end = document.getElementById('proj-end');

  if(start && end){
    start.addEventListener('change', ()=> {
      if(end.value && start.value && end.value < start.value) end.value = start.value;
      end.min = start.value || '';
    });
    end.addEventListener('change', ()=> {
      if(start.value && end.value < start.value){
        alert('Data de término não pode ser anterior ao início.');
        end.value = start.value;
      }
    });
  }
})();
</script>
{% endblock %}
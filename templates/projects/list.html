{% extends "base.html" %}
{% load static %}
{% block title %}Projetos — ARPIA{% endblock %}

{% block content %}
<div class="main">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
    <h2 style="margin:0;color:var(--text)">Projetos</h2>
    <div>
      <a href="{% url 'projects_create' %}" class="btn btn-primary" id="btn-new-project" style="display:inline-flex;align-items:center;gap:.6rem;padding:.45rem .8rem;border-radius:8px;background:linear-gradient(90deg,#4fd1c5,var(--accent));color:#021023;text-decoration:none;font-weight:700;">
        Novo Projeto
      </a>
    </div>
  </div>

  <div class="card" style="padding:0.75rem;">
    <div style="overflow:auto;">
      <table id="projects-table" class="projects-table" style="width:100%;border-collapse:collapse;color:var(--muted);">
        <thead>
          <tr style="text-align:left;font-weight:700;color:var(--muted);font-size:.9rem;">
            <th class="id-col" style="padding:.45rem .5rem;border-bottom:1px solid rgba(255,255,255,0.04);min-width:56px;text-align:center">ID</th>
            <th class="name-col" style="padding:.45rem .5rem;border-bottom:1px solid rgba(255,255,255,0.04);min-width:200px">Nome</th>
            <th style="padding:.45rem .5rem;border-bottom:1px solid rgba(255,255,255,0.04);width:140px">Dono</th>
            <th style="padding:.45rem .5rem;border-bottom:1px solid rgba(255,255,255,0.04);width:120px">Criado em</th>
            <th style="padding:.45rem .5rem;border-bottom:1px solid rgba(255,255,255,0.04);width:110px">Status</th>
            <th class="actions-col" style="padding:.45rem .5rem;border-bottom:1px solid rgba(255,255,255,0.04);width:220px;text-align:right">Ações</th>
          </tr>
        </thead>
        <tbody id="projects-body">
          {% for p in projects %}
          <tr class="row">
            <td class="id-col" style="padding:.45rem .5rem;text-align:center;vertical-align:middle;white-space:nowrap;">{{ p.id }}</td>
            <td class="name-col" style="padding:.45rem .5rem;color:var(--text);vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:140px;max-width:55%;">{{ p.name }}</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">{{ p.owner }}</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">{{ p.created }}</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">
              <span style="padding:.18rem .45rem;border-radius:6px;background:rgba(255,255,255,0.02);color:var(--muted);font-weight:600">{{ p.status }}</span>
            </td>
            <td class="actions-col" style="padding:.45rem .5rem;vertical-align:middle;text-align:right;">
              <!-- Botões de ação: ícones somente -->
              <a href="{{ p.detail_url }}" class="btn-icon btn-info" title="Ver" aria-label="Ver projeto {{ p.name }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </a>

              <a href="{{ p.edit_url }}" class="btn-icon btn-success" title="Editar" aria-label="Editar projeto {{ p.name }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M3 21l3-1 11-11 1-3L14 3 3 14v7z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </a>

              <a href="{{ p.share_url }}" class="btn-icon btn-warning" title="Compartilhar" aria-label="Compartilhar projeto {{ p.name }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M4 12v7a1 1 0 001 1h14a1 1 0 001-1v-7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 6l-4-4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 2v13" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </a>
            </td>
          </tr>
          {% empty %}
          <!-- exemplos fictícios para demonstração visual -->
          <tr class="row">
            <td class="id-col" style="padding:.45rem .5rem;text-align:center;vertical-align:middle;white-space:nowrap;">1</td>
            <td class="name-col" style="padding:.45rem .5rem;color:var(--text);vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:140px;max-width:55%;">Executive summary — Infra Red Team</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">Infra Red Team</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">2025-09-01</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">
              <span style="padding:.18rem .45rem;border-radius:6px;background:rgba(79,209,197,0.06);color:#4fd1c5;font-weight:700">Ativo</span>
            </td>
            <td class="actions-col" style="padding:.45rem .5rem;vertical-align:middle;text-align:right;">
              <button type="button" class="btn-icon btn-info" title="Ver" data-action="view" data-id="1" aria-label="Ver projeto 1">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
              <a href="#" class="btn-icon btn-success" title="Editar" aria-label="Editar projeto 1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 21l3-1 11-11 1-3L14 3 3 14v7z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
              <a href="#" class="btn-icon btn-warning" title="Compartilhar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M4 12v7a1 1 0 001 1h14a1 1 0 001-1v-7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 6l-4-4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 2v13" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
              <button type="button" class="btn-icon btn-danger" title="Apagar" data-action="delete" data-id="1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 6h18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 6v14a1 1 0 001 1h6a1 1 0 001-1V6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </td>
          </tr>

          <tr class="row">
            <td class="id-col" style="padding:.45rem .5rem;text-align:center;vertical-align:middle;white-space:nowrap;">2</td>
            <td class="name-col" style="padding:.45rem .5rem;color:var(--text);vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:140px;max-width:55%;">Full report — Web App Audit</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">Web App Audit</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">2025-08-21</td>
            <td style="padding:.45rem .5rem;vertical-align:middle;">
              <span style="padding:.18rem .45rem;border-radius:6px;background:rgba(255,184,93,0.06);color:#ffb85d;font-weight:700">Em fila</span>
            </td>
            <td class="actions-col" style="padding:.45rem .5rem;vertical-align:middle;text-align:right;">
              <button type="button" class="btn-icon btn-info" title="Ver" data-action="view" data-id="2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
              <a href="#" class="btn-icon btn-success" title="Editar" aria-label="Editar projeto 2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 21l3-1 11-11 1-3L14 3 3 14v7z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
              <a href="#" class="btn-icon btn-warning" title="Compartilhar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M4 12v7a1 1 0 001 1h14a1 1 0 001-1v-7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 6l-4-4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 2v13" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
              <button type="button" class="btn-icon btn-danger" title="Apagar" data-action="delete" data-id="2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 6h18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 6v14a1 1 0 001 1h6a1 1 0 001-1V6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- server-side paginator -->
    <div style="display:flex;align-items:center;justify-content:space-between;padding:.7rem .3rem;margin-top:.6rem;">
      <div>
        Mostrar
        <select id="page-size" onchange="location.search='page=1&page_size='+this.value" style="padding:.25rem .4rem;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);">
          <option value="5" {% if projects_page.paginator.per_page == 5 %}selected{% endif %}>5</option>
          <option value="10" {% if projects_page.paginator.per_page == 10 %}selected{% endif %}>10</option>
          <option value="25" {% if projects_page.paginator.per_page == 25 %}selected{% endif %}>25</option>
        </select>
        entradas
      </div>

      <div id="paginator" style="display:flex;gap:.35rem;align-items:center;">
        {% if projects_page.has_previous %}
          <a href="?page={{ projects_page.previous_page_number }}&page_size={{ projects_page.paginator.per_page }}" class="btn-pager">«</a>
        {% else %}
          <span class="btn-pager disabled">«</span>
        {% endif %}

        {% for num in projects_page.paginator.page_range %}
          {% if num == projects_page.number %}
            <span class="btn-pager active">{{ num }}</span>
          {% else %}
            <a href="?page={{ num }}&page_size={{ projects_page.paginator.per_page }}" class="btn-pager">{{ num }}</a>
          {% endif %}
        {% endfor %}

        {% if projects_page.has_next %}
          <a href="?page={{ projects_page.next_page_number }}&page_size={{ projects_page.paginator.per_page }}" class="btn-pager">»</a>
        {% else %}
          <span class="btn-pager disabled">»</span>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
/* botões de ícone para ações (pequeno scope no template) */
.btn-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:32px;
  height:32px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.03);
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  margin-right:4px;
}
.btn-icon svg{ display:block; }

.btn-info{ background: rgba(96,165,250,0.06); color:var(--accent-2); border-color: rgba(96,165,250,0.08); }
.btn-success{ background: rgba(79,209,197,0.06); color:#4fd1c5; border-color: rgba(79,209,197,0.08); }
.btn-warning{ background: rgba(255,184,93,0.06); color:#ffb85d; border-color: rgba(255,184,93,0.08); }
.btn-danger{ background: rgba(255,139,139,0.06); color:#ff8b8b; border-color: rgba(255,139,139,0.08); }

/* ajuste de células da tabela */
.projects-table th, .projects-table td{
  padding: .45rem .5rem;
  vertical-align:middle;
  overflow:hidden;
}
.projects-table{ table-layout:auto; } /* deixar a tabela ajustar ao conteúdo */
.projects-table .id-col{ min-width:56px; width:auto; text-align:center; }
.projects-table .name-col{ min-width:140px; max-width:55%; }
.projects-table .actions-col{ width:220px; text-align:right; white-space:nowrap; }

/* pager simples */
.btn-pager{
  display:inline-flex;
  padding:.28rem .5rem;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.03);
  text-decoration:none;
  color:var(--muted);
}
.btn-pager.active{ background:rgba(255,255,255,0.03); color:var(--text); font-weight:700; }
.btn-pager.disabled{ opacity:0.45; cursor:default; }
</style>

<script>
  // ações fictícias: substituir por endpoints reais
  (function(){
    const table = document.getElementById('projects-body');
    table.addEventListener('click', (ev)=>{
      const btn = ev.target.closest('button[data-action]');
      if(!btn) return;
      const action = btn.dataset.action;
      if(action === 'delete'){
        const id = btn.dataset.id;
        if(!confirm('Confirma apagar o projeto #' + id + '?')) return;
        alert('Apagar: ' + id + ' (implemente endpoint)');
        return;
      }
    });
  })();
</script>
{% endblock %}
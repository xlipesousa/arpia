from django.contrib.auth import get_user_model
from django.test import TestCase
from django.urls import reverse

from arpia_core.models import Project


class PentestDashboardViewTests(TestCase):
	def setUp(self):
		self.user = get_user_model().objects.create_user("pentester", password="pass1234")
		self.older = Project.objects.create(owner=self.user, name="Projeto Pentest Antigo", slug="projeto-pentest-antigo")

	def test_projects_sorted_by_most_recent_first(self):
		newer = Project.objects.create(owner=self.user, name="Projeto Pentest Recente", slug="projeto-pentest-recente")

		self.client.login(username="pentester", password="pass1234")
		response = self.client.get(reverse("arpia_pentest:dashboard"))

		self.assertEqual(response.status_code, 200)
		projects = response.context["projects"]
		self.assertGreaterEqual(len(projects), 2)
		self.assertEqual([project.pk for project in projects[:2]], [newer.pk, self.older.pk])
